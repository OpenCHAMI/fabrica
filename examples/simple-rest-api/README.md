<!--
Copyright © 2025 OpenCHAMI a Series of LF Projects, LLC

SPDX-License-Identifier: MIT
-->

# Simple REST API Example

This example demonstrates the **simplest possible** way to use Fabrica - as a code generator for basic CRUD APIs without any Kubernetes concepts.

## What This Example Shows

- ✅ Plain Go structs (no resource embedding)
- ✅ Automatic CRUD endpoint generation
- ✅ In-memory storage (no database setup)
- ✅ Basic JSON validation
- ❌ No labels, annotations, or metadata
- ❌ No reconciliation or events
- ❌ No versioning

**Learning Time:** 30 minutes
**Skill Level:** Beginner (basic Go knowledge)

## Project Structure

```
simple-rest-api/
├── README.md                    # This file
├── go.mod                       # Go dependencies
├── product.go                   # Your data definition
└── main.go                      # Generated server (simulation)
```

## The Data Model

This example manages a simple product catalog:

```go
type Product struct {
    ID          string  `json:"id"`
    Name        string  `json:"name"`
    Description string  `json:"description"`
    Price       float64 `json:"price"`
    InStock     bool    `json:"inStock"`
}
```

Just a plain struct - no magic!

## How to Use

### 1. Review the Code

```bash
cat product.go  # See your data definition
cat main.go     # See what Fabrica would generate
```

### 2. Run the Server

```bash
go run .
```

### 3. Test the API

```bash
# Create a product
curl -X POST http://localhost:8080/products \
  -H "Content-Type: application/json" \
  -d '{
    "id": "prod-1",
    "name": "Laptop",
    "price": 999.99,
    "inStock": true
  }'

# Get all products
curl http://localhost:8080/products

# Get one product
curl http://localhost:8080/products/prod-1

# Update a product
curl -X PUT http://localhost:8080/products/prod-1 \
  -H "Content-Type: application/json" \
  -d '{
    "id": "prod-1",
    "name": "Gaming Laptop",
    "price": 1299.99,
    "inStock": true
  }'

# Delete a product
curl -X DELETE http://localhost:8080/products/prod-1
```

## What Gets Generated (Simulated)

In a real Fabrica setup, running `fabrica add resource Product` would generate:

1. **HTTP Handlers** - Functions to handle each REST operation
2. **Storage Layer** - Thread-safe in-memory storage with CRUD operations
3. **Routes** - URL routing configuration
4. **Server** - HTTP server setup and startup code

**Total generated code:** ~200 lines to give you a complete API!

## Key Concepts

### Simple Mode vs Standard Mode

This example uses **simple mode**:
- No `resource.Resource` embedding
- No labels or annotations
- No status/spec separation
- Just plain data structures

**When to use simple mode:**
- Quick prototypes
- Internal tools
- Learning Fabrica basics
- You don't need advanced features

**When to upgrade to standard mode:**
- Need to track metadata (who created, when)
- Want filtering by labels
- Need lifecycle management
- Building production systems

See [getting-started.md](../../docs/getting-started.md) for standard mode.

## Next Steps

Once you're comfortable with this example:

1. **Add Validation** - See [validation.md](../../docs/validation.md)
2. **Multiple Resources** - Add User, Order, Category types
3. **Learn Resource Model** - Progress to [getting-started.md](../../docs/getting-started.md)
4. **Advanced Patterns** - Explore reconciliation and events

## Comparison: Simple vs Standard Mode

### Simple Mode (This Example)

```go
type Product struct {
    ID          string  `json:"id"`
    Name        string  `json:"name"`
    Price       float64 `json:"price"`
}
```

**Pros:** Dead simple, familiar, quick to learn
**Cons:** No metadata, no advanced features

### Standard Mode

```go
type Product struct {
    resource.Resource  // Embeds: ID, labels, annotations, timestamps
    Spec   ProductSpec   `json:"spec"`
    Status ProductStatus `json:"status,omitempty"`
}

type ProductSpec struct {
    Name  string  `json:"name"`
    Price float64 `json:"price"`
}
```

**Pros:** Full power, production-ready, metadata tracking
**Cons:** Steeper learning curve

**You can start simple and upgrade later!** Your data remains the same, you just wrap it in the resource model.

## Files Explained

### `product.go`
Your data definition. This is the ONLY file you need to write. Everything else is generated by Fabrica.

### `main.go`
A **simulation** of what Fabrica would generate. In real usage, this file is auto-generated and you never edit it.

The real magic happens when you run:
```bash
fabrica add resource Product
```

That command analyzes `product.go` and generates all the boilerplate automatically.

## Running This Example

```bash
# From the examples/simple-rest-api directory:
go mod tidy
go run .
```

Then test with curl commands shown above.

## Questions?

- **"Why is main.go here if it's generated?"** - For educational purposes, so you can see what Fabrica creates
- **"Can I edit main.go?"** - In real projects, no - it's regenerated each time. Add custom logic elsewhere.
- **"Where's the database?"** - This example uses in-memory storage. Add persistent storage later as needed.
- **"Is this production-ready?"** - Simple mode is great for prototypes. For production, use standard mode with proper storage.

## Related Examples

- [conditional-patch](../conditional-patch/) - Advanced example with full resource model
- [validation](../validation-beginner/) - Adding input validation

## License

MIT License - see top of file
